<!-- REFERENCES -->

<!--   
1) emunsing (2015). Find max/min value in a Javascript set. Stack Overflow. [online] 
Available at: https://stackoverflow.com/questions/32111045/find-max-min-value-in-a-javascript-set
-->




<!DOCTYPE html>

<html lang = "en">
    <head>
        <script src='https://d3js.org/d3.v7.min.js'></script>
    </head>

    <style>
        .bar {
            fill: steelblue;
        }
        /* .highlight {
            fill: orange;
        } */
    </style>

    <body>
        <script type='text/javascript' src='https://d3js.org/d3.v7.min.js'></script>

        <svg width="600" height="500"></svg>

        <script>
            var svg = d3.select("svg");
            var margin = 200;
            var width = svg.attr("width") - margin;
            var height = svg.attr("height") - margin;

            let csvFile = "https://raw.githubusercontent.com/ayushiiamin/csvfileimp/main/csvfile.csv";

            svg.append("text")
                .attr("transform", "translate(100,0)")
                .attr("x", 50)
                .attr("y", 50)
                .attr("font-size", "24px")
                .text("Stock Price")

            var x = d3.scaleBand().range([0, width]).padding(0.4);
            var y = d3.scaleLinear().range([height, 0]);
            var set = new Set();
            var num;
            

            var g = svg.append("g")
                        .attr("transform", "translate(" + 100 + "," + 100 + ")");

            d3.csv(csvFile).then(function(data) {
                x.domain( data.map(function(d) { 
                    return d.year; 
                }) );

                y.domain([0, d3.max(data, function(d) {
                    // arr.push(d.value);
                    num = parseInt(d.value)
                    set.add(num)
                    // console.log(d3.min(set))
                    return d.value; 
                })]);

            // var barColor = d3.scaleOrdinal()
            //                   .domain(data)
            //                   .range(["purple", "blue", "green", "yellow", "red", "pink"]);

            var barColor = d3.scaleLinear()
                            .domain([47,75])
                            .range(["#412F88", "#D3212D"])
            
            var xAxis = d3.axisBottom()
                            .scale(x);

            var yAxis = d3.axisLeft()
                            .scale(y);

            var maxValue = d3.max(set)    //(emunsing, 2015)
            //console.log(maxValue)

            var minValue = d3.min(set)    //(emunsing, 2015)
            //console.log(minValue)

            g.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis)
                .append("text")
                .attr("y", height - 250)
                .attr("x", width - 100)
                .attr("text-anchor", "end")
                .attr("stroke", "black")
                .text("Year");

            g.append("g")
                .call(yAxis.tickFormat(function(d){
                    return "$" + d;
                })
                .ticks(10))
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", "-5.1em")
                .attr("text-anchor", "end")
                .attr("stroke", "black")
                .text("Stock Price");

            g.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("fill", "steelblue")
                .on("mouseover", onMouseOver)
                .on("mouseout", onMouseOut)
                .attr("x", function(d) { 
                    return x(d.year); 
                })
                .attr("y", function(d) { 
                    return y(d.value); 
                })
                .attr("width", x.bandwidth())
                .transition()
                .ease(d3.easeLinear)
                .duration(400)
                .delay(function (d, i) {
                    return i * 50;
                })
                .attr("height", function(d) { 
                    return height - y(d.value); 
                });

                function onMouseOver(d, i) {
                    //console.log(i)
                    // d3.select(this).attr('class', 'highlight');

                    d3.select(this)
                        .transition() // adds animation
                        .duration(400)
                        .attr('width', x.bandwidth() + 5)
                        .attr("fill", function(d){
                            // alert(typeof d)
                            //alert(arr)
                            //console.log(d.value)
                            if(d.value == minValue){
                                return "blue"
                            }
                            else if(d.value == maxValue){
                                return "red"
                            }
                            else{
                                // console.log(barColor(d.value))
                                return barColor(d.value)
                            }
                            
                        })
                        .attr("y", function(d) { 
                            //alert(y(d.value))
                            return y(d.value) - 10; 
                        })
                        .attr("height", function(d) { 
                            return height - y(d.value) + 10; 
                        });

                    g.append("text")
                        .attr('class', 'val')
                        .attr('x', function() {
                            //alert(i)
                            return x(i.year) +8;
                        })
                        .attr('y', function() {
                            //alert(y(d.value))
                            return y(i.value) - 15;
                        })
                        .text( function() { 
                            return '$' + i.value; 
                        } ); // Value of the text
                }

                //mouseout event handler function
                function onMouseOut(d, i) {
                // use the text label class to remove label on mouseout
                // d3.select(this).attr('class', 'bar');

                d3.select(this)
                    .transition() // adds animation
                    .duration(400)
                    .attr('width', x.bandwidth())
                    .attr("fill", "steelblue")
                    .attr("y", function(d) { 
                        return y(i.value); 
                    })
                    .attr("height", function(d) { 
                        return height - y(i.value); 
                    });
                    
                d3.selectAll('.val')
                    .remove()
                }
            });
            </script>   
    </body>
</html>